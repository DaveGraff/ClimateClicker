<!DOCTYPE html>
<html>
<head>
	<title>Climate Clicker</title>
	<link href="..\static\css\main.css" type="text/css" rel="stylesheet"></link>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body style="background-image: url('../static/images/Background.jpg');">
	<img id="mainIcon" src="..\static\images\Recycle.png">
	<div id="upgradePanel">
		<button class="collapsible" id="upgrades">Upgrades</button>
		<div class="content">
			<button id="upgrade1" onclick="handleUpgrade(-1, 1, 'upgrade1', 25)">Double Click!</button>
			<!-- <button id="upgrade2" onclick="handleUpgrade(-1, 1, 'upgrade2')">Double Click!</button>
			<button id="upgrade3" onclick="handleUpgrade(0, 1, 'upgrade3')">Double Click!</button>
			<button id="upgrade4" onclick="handleUpgrade(0, 1, 'upgrade4')">Double Click!</button>
			<button id="upgrade5" onclick="handleUpgrade(1, 1, 'upgrade5')">Double Click!</button>
			<button id="upgrade6" onclick="handleUpgrade(1, 1, 'upgrade6')">Double Click!</button>
			<button id="upgrade7" onclick="handleUpgrade(2, 1, 'upgrade7')">Double Click!</button>
			<button id="upgrade8" onclick="handleUpgrade(2, 1, 'upgrade8')">Double Click!</button>
			<button id="upgrade9" onclick="handleUpgrade(3, 1, 'upgrade9')">Double Click!</button>
			<button id="upgrade10" onclick="handleUpgrade(3, 1, 'upgrade10')">Double Click!</button>
			<button id="upgrade11" onclick="handleUpgrade(4, 1, 'upgrade11')">Double Click!</button>
			<button id="upgrade12" onclick="handleUpgrade(4, 1, 'upgrade12')">Double Click!</button>
			<button id="upgrade13" onclick="handleUpgrade(5, 1, 'upgrade13')">Double Click!</button>
			<button id="upgrade14" onclick="handleUpgrade(5, 1, 'upgrade14')">Double Click!</button>
			<button id="upgrade15" onclick="handleUpgrade(6, 1, 'upgrade15')">Double Click!</button>
			<button id="upgrade16" onclick="handleUpgrade(6, 1, 'upgrade16')">Double Click!</button> -->
		</div>
	</div>
	<div id="itemsPanel">
		<h1>Items</h1>
		<ul id="itemsList" style="">
			<li>
				<h2>Grab a friend</h2>
				<p>Owned: <span>0</span> Cost: <span>0</span></p>
			</li>
			<li>
				<h2>Organize a community cleanup</h2>
				<p>Owned: <span>0</span> Cost: <span>0</span></p>
			</li>
			<li>
				<h2>Convince a local official</h2>
				<p>Owned: <span>0</span> Cost: <span>0</span></p>
			</li>
			<li>
				<h2>Get a law passed</h2>
				<p>Owned: <span>0</span> Cost: <span>0</span></p>
			</li>
			<li>
				<h2>Make a new Earth Day</h2>
				<p>Owned: <span>0</span> Cost: <span>0</span></p>
			</li>
			<li>
				<h2>Create a carbon tax</h2>
				<p>Owned: <span>0</span> Cost: <span>0</span></p>
			</li>
			<li>
				<h2>Set an emissions goal</h2>
				<p>Owned: <span>0</span> Cost: <span>0</span></p>
			</li>
		</ul>
	</div>
	<div id="pointsCounterPanel">
		<h2>Points: <span id="pointsCounter"></span></h2>
	</div>
	<div id="climateState"></div>
	
</body>
<script type="text/javascript">
		//Call timing function
		setInterval(Function("timeIncrement();"), 1000);

		//Initialize the two most important variables
		var climateState = 0;
		pointsCounter = 0;

		//Help the climate & your points by clicking!
		clickPower = 1;
		updatePoints(0);
		$("#climateState").text(climateState);
		$("#mainIcon").click(function(evt){
			updatePoints(clickPower);
			$("#climateState").text(++climateState);
		});

		itemCount = new Array($('#itemsList li').length).fill(0);
		itemEffectiveness = new Array($('#itemsList li').length).fill(1);

		$("#itemsList li").each(function(){
			index = $(this).index();
			//Set cost
			$(this).children().eq(1).children().eq(1).text(itemCost(index, itemCount[index]));

			$(this).click(function(e){
				index = $(this).index();
				cost = itemCost(index, itemCount[index]);
				if(cost <= pointsCounter){
					updatePoints(-(cost));
					//Reset cost
					$(this).children().eq(1).children().eq(1).text(itemCost(index, ++itemCount[index]));
					//Reset num owned
					$(this).children().eq(1).children().eq(0).text(itemCount[index]);
				}
				e.preventDefault();
			});
		});

		var timePassed = 0;
		function timeIncrement(){
			climateState -= Math.pow(2, Math.floor(timePassed / 30));

			for (var i = 0; i < itemCount.length; i++) {
				gain = itemGain(i);
				updatePoints(gain);
				climateState += gain;
				$("#climateState").text(climateState);
			}

			$("#climateState").text(climateState);
			timePassed++;
		}



		function itemCost(index, numOwned){
			return Math.ceil(Math.pow(2, index*3) * Math.pow(1.5, numOwned));
		}

		function itemGain(index){
			return Math.ceil(Math.pow(2, 2 * index) * itemEffectiveness[index] * itemCount[index]);
		}

		function updatePoints(change) {
			pointsCounter += change;
			$("#pointsCounter").text(pointsCounter);
		}

		function handleUpgrade(upgradeIndex, change, upgradeId, cost){
			if(cost <= pointsCounter){
				updatePoints(-25);
				if(upgradeIndex == -1)
					clickPower += change;
				else
					itemEffectiveness[upgradeIndex] += change;
				$('#' + upgradeId).detach();
			}
		}
</script>
<script>
		var coll = document.getElementsByClassName("collapsible");
		var row = document.getElementsByClassName("side_collapsible");
		var i;
		for (i = 0; i < coll.length; i++) {
		  coll[i].addEventListener("click", function() {
		    this.classList.toggle("active");
		    var content = this.nextElementSibling;
		    if (content.style.maxHeight){
		      content.style.maxHeight = null;
		    } else {
		      content.style.maxHeight = content.scrollHeight + "px";
		    }
		  });
		}
	</script>
</html>